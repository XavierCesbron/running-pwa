<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Running PWA Calculator</title>

  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#FC4C02" />

  <style>
    :root {
      --strava-orange: #FC4C02;
      --strava-light: #ff6628;
      --strava-dark: #cc3c02;
    }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      padding-bottom: 60px; /* Espace pour la barre de navigation */
    }
    header {
      background: var(--strava-orange);
      color: white;
      padding: 15px;
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .tab-bar {
      position: fixed;
      bottom: 0;
      width: 100%;
      display: flex;
      background: white;
      border-top: 1px solid #ccc;
      box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.05);
      z-index: 10;
    }
    .tab {
      flex: 1;
      text-align: center;
      padding: 12px 10px;
      font-size: 14px;
      cursor: pointer;
      color: #777;
      transition: color 0.3s;
    }
    .tab.active {
      color: var(--strava-orange);
      font-weight: bold;
      border-top: 3px solid var(--strava-orange);
      margin-top: -3px;
    }
    .page {
      display: none;
      padding: 20px;
      padding-bottom: 70px;
    }
    .page.active {
      display: block;
    }
    .input-group {
        background: white;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
    }
    label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #333;
        font-size: 14px;
    }
    input[type="number"], input[type="text"], select {
      width: 100%;
      padding: 10px;
      margin: 5px 0 15px 0;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box; 
    }
    button {
      padding: 12px;
      width: 100%;
      background: var(--strava-orange);
      border: none;
      color: white;
      font-size: 18px;
      margin-top: 10px;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover {
        background: var(--strava-light);
    }
    .result {
      margin-top: 25px;
      padding: 15px;
      background: white;
      border-radius: 8px;
      font-size: 16px;
      line-height: 1.6;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    .result-section {
        margin-bottom: 15px;
        padding: 10px 0;
        border-bottom: 1px dashed #eee;
    }
    .result-section:last-child {
        border-bottom: none;
    }
    .result h3 {
        color: var(--strava-orange);
        margin-top: 0;
        margin-bottom: 10px;
        font-size: 1.2em;
        border-bottom: 2px solid #f0f0f0;
        padding-bottom: 5px;
    }
    .toggle-group {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
    }
    .toggle-input {
        flex: 1;
    }
    .radio-container {
      display: flex;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
      overflow: hidden;
    }
    .radio-label {
      flex: 1;
      text-align: center;
      padding: 10px;
      background-color: #f9f9f9;
      cursor: pointer;
      font-weight: bold;
      font-size: 14px;
    }
    .radio-input:checked + .radio-label {
      background-color: var(--strava-orange);
      color: white;
      border: none;
    }
    .radio-input {
      display: none;
    }
    .hidden-fields {
        display: none;
        margin-top: 10px;
    }
    .passages-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
        font-size: 14px;
    }
    .passages-table th, .passages-table td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: center;
    }
    .passages-table th {
        background-color: #f0f0f0;
        color: #333;
    }
    .passages-table tr:nth-child(even) {
        background-color: #f9f9f9;
    }

    /* Style sp√©cifique pour les zones */
    .zone-item {
        margin-bottom: 15px;
        padding: 10px 15px;
        border-radius: 6px;
        background: #fff;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        border-left: 5px solid; /* Couleur d√©finie par JS */
    }
    .zone-title {
        font-weight: bold;
        font-size: 1.1em;
        margin-bottom: 5px;
        color: #333;
    }
    .zone-data p {
        margin: 4px 0;
        font-size: 0.95em;
        color: #555;
    }
    .zone-data span {
        font-weight: bold;
        color: #222;
    }
  </style>
</head>

<body>

<header>Running Calculator</header>

<div id="page1" class="page active">
  <h2>Temps de passage (Course)</h2>
  <div class="input-group">
    <label for="distance1">Distance</label>
    <div class="toggle-group">
      <div class="toggle-input">
        <input id="distance1" type="number" value="10" />
      </div>
      <div class="toggle-input">
        <select id="unit1">
          <option value="km">km</option>
          <option value="m">m</option>
        </select>
      </div>
    </div>
    
    <label for="input-speed-pace1">Vitesse (km/h) ou Allure (min/km)</label>
    <input id="input-speed-pace1" type="text" placeholder="Ex: 12 (km/h) ou 5:00 (min/km)" />

    <label for="pace-interval">Affichage des passages tous les (km)</label>
    <select id="pace-interval">
        <option value="1">1 km</option>
        <option value="2">2 km</option>
        <option value="3">3 km</option>
        <option value="5">5 km</option>
        <option value="10">10 km</option>
    </select>

    <button onclick="calculCourse()">Calculer</button>
  </div>
  <div id="res1" class="result"></div>
</div>

<div id="page2" class="page">
  <h2>Temps S√©ance</h2>
  <div class="input-group">
    <label for="distance2">Distance</label>
    <div class="toggle-group">
      <div class="toggle-input">
        <input id="distance2" type="number" value="1" />
      </div>
      <div class="toggle-input">
        <select id="unit2">
          <option value="km">km</option>
          <option value="m">m</option>
        </select>
      </div>
    </div>
    
    <div class="radio-container">
        <input type="radio" id="seance-type-speed" name="seance-type" value="speed" checked class="radio-input" onchange="toggleSeanceInput('speed')">
        <label for="seance-type-speed" class="radio-label">Vitesse/Allure</label>

        <input type="radio" id="seance-type-vma" name="seance-type" value="vma" class="radio-input" onchange="toggleSeanceInput('vma')">
        <label for="seance-type-vma" class="radio-label">VMA / %VMA</label>
    </div>

    <div id="fields-speed" class="fields-container">
        <label for="input-speed-pace2">Vitesse (km/h) ou Allure (min/km)</label>
        <input id="input-speed-pace2" type="text" placeholder="Ex: 14 (km/h) ou 4:17 (min/km)" />
    </div>

    <div id="fields-vma" class="fields-container hidden-fields">
        <label for="vma-seance">VMA (km/h)</label>
        <input id="vma-seance" type="number" placeholder="Ex: 18" />
        
        <label for="percent-vma-seance">Pourcentage de r√©alisation VMA (%)</label>
        <input id="percent-vma-seance" type="number" placeholder="Ex: 85" min="1" max="100" />
    </div>

    <button onclick="calculSeance()">Calculer</button>
  </div>
  <div id="res2" class="result"></div>
</div>

<div id="page3" class="page">
  <h2>Zones de Travail / Pr√©diction</h2>
  <div class="input-group">
    <label for="vma">VMA (km/h)</label>
    <input id="vma" type="number" placeholder="Ex: 18" value="18" />

    <label for="fcmax">FCmax (bpm) - Optionnel</label>
    <input id="fcmax" type="number" placeholder="Ex: 190" />

    <button onclick="calculZones()">Calculer</button>
  </div>
  <div id="res3" class="result"></div>
</div>

<div class="tab-bar">
  <div class="tab active" onclick="switchTab(1)">üèÉ Course</div>
  <div class="tab" onclick="switchTab(2)">‚è± S√©ance</div>
  <div class="tab" onclick="switchTab(3)">üìä Zones</div>
</div>

<script>
// --- UTILS DE CONVERSION ---

/** Convertit une allure (min:sec) ou une vitesse (km/h) en secondes par km (s/km) */
function allureToSecPerKm(allureStr) {
  if (!allureStr || typeof allureStr !== 'string') return 0;
  allureStr = allureStr.trim();
  
  if (!allureStr.includes(':')) {
      const speed = Number(allureStr);
      if (speed <= 0 || isNaN(speed)) return 0;
      return (3600 / speed); // secondes par km
  }
  let parts = allureStr.split(":");
  if (parts.length < 2) return 0;

  let [m, s] = parts.map(Number);
  if (isNaN(m) || isNaN(s)) return 0;

  return (m * 60) + s;
}

/** Convertit des secondes par km (s/km) en allure (mm:ss) */
function secPerKmToAllure(sec) {
  if (sec <= 0 || isNaN(sec)) return "N/A";
  let m = Math.floor(sec / 60);
  let s = Math.floor(sec % 60).toString().padStart(2, "0");
  return m + ":" + s;
}

/** Convertit des secondes totales en format H:MM:SS */
function secToTime(sec) {
    if (sec <= 0 || isNaN(sec)) return "00:00:00";
    const h = Math.floor(sec / 3600);
    const m = Math.floor((sec % 3600) / 60);
    const s = Math.floor(sec % 60);
    return `${h.toString().padStart(2, "0")}:${m.toString().padStart(2, "0")}:${s.toString().padStart(2, "0")}`;
}

/** Convertit une allure (s/km) en Vitesse (km/h) */
function secPerKmToKmh(secPerKm) {
    if (secPerKm <= 0 || isNaN(secPerKm)) return 0;
    return (3600 / secPerKm).toFixed(2);
}

// --- LOGIQUE DES ONGLETS ET AFFICHAGE ---

function switchTab(n) {
  document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
  document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
  document.getElementById("page" + n).classList.add("active");
  document.querySelectorAll(".tab")[n-1].classList.add("active");
  if (n === 2) {
      const type = document.querySelector('input[name="seance-type"]:checked').value;
      toggleSeanceInput(type);
  }
}

function toggleSeanceInput(type) {
    document.getElementById('fields-speed').classList.toggle('hidden-fields', type === 'vma');
    document.getElementById('fields-vma').classList.toggle('hidden-fields', type === 'speed');
}

// --- 1. TEMPS DE PASSAGE COURSE (Fonctionnalit√© non modifi√©e) ---

function calculCourse() {
    let distanceInput = document.getElementById("distance1").value;
    let unit = document.getElementById("unit1").value;
    let allureInput = document.getElementById("input-speed-pace1").value.trim();
    let interval = Number(document.getElementById("pace-interval").value);
    const resDiv = document.getElementById("res1");
    resDiv.innerHTML = '';

    let distanceKm = (unit === 'm') ? Number(distanceInput) / 1000 : Number(distanceInput);
    let allureSecPerKm = allureToSecPerKm(allureInput);

    if (isNaN(distanceKm) || distanceKm <= 0 || isNaN(allureSecPerKm) || allureSecPerKm <= 0) {
        resDiv.innerHTML = "<p style='color:red;'>Veuillez saisir une distance et une allure/vitesse valides.</p>";
        return;
    }

    const totalSec = distanceKm * allureSecPerKm;

    let output = '<div class="result-section">';
    output += `<h3>R√©capitulatif de la course</h3>`;
    output += `* Distance totale : ${distanceKm.toFixed(2)} km<br>`;
    output += `* Allure Kilom√©trique : ${secPerKmToAllure(allureSecPerKm)}/km<br>`;
    output += `* Vitesse : ${secPerKmToKmh(allureSecPerKm)} km/h<br>`;
    output += `* Temps total estim√© : ${secToTime(totalSec)}</div>`;

    output += '<div class="result-section">';
    output += `<h3>Temps de passage (tous les ${interval} km)</h3>`;

    let passages = '';
    let cumulativeSec = 0;
    let maxPassageKm = Math.floor(distanceKm / interval) * interval;

    if (maxPassageKm > 0) {
        passages += `<table class="passages-table"><thead><tr><th>Distance (km)</th><th>Temps cumul√©</th></tr></thead><tbody>`;
        for (let km = interval; km <= maxPassageKm; km += interval) {
            cumulativeSec = km * allureSecPerKm;
            passages += `<tr><td>${km}</td><td>${secToTime(cumulativeSec)}</td></tr>`;
        }
        
        if (distanceKm > 0 && distanceKm !== maxPassageKm) {
            passages += `<tr style="font-weight: bold;"><td>${distanceKm.toFixed(2)} (Total)</td><td>${secToTime(totalSec)}</td></tr>`;
        } else if (distanceKm === maxPassageKm && maxPassageKm > 0) {
            passages = passages.slice(0, passages.lastIndexOf('<tr>'));
            passages += `<tr style="font-weight: bold;"><td>${distanceKm.toFixed(2)}</td><td>${secToTime(totalSec)}</td></tr>`;
        }
        passages += `</tbody></table>`;
    } else {
        passages += `<p>La distance est trop courte pour afficher des passages de ${interval} km. Temps total : ${secToTime(totalSec)}</p>`;
    }
    output += passages + '</div>';

    resDiv.innerHTML = output;
}


// --- 2. TEMPS DE PASSAGE S√âANCE (Fonctionnalit√© non modifi√©e) ---

function calculSeance() {
    let distanceInput = document.getElementById("distance2").value;
    let unit = document.getElementById("unit2").value;
    let type = document.querySelector('input[name="seance-type"]:checked').value;
    const resDiv = document.getElementById("res2");
    resDiv.innerHTML = '';

    let distanceKm = (unit === 'm') ? Number(distanceInput) / 1000 : Number(distanceInput);
    let allureSecPerKm = 0;

    if (isNaN(distanceKm) || distanceKm <= 0) {
        resDiv.innerHTML = "<p style='color:red;'>Veuillez saisir une distance valide.</p>";
        return;
    }

    if (type === 'speed') {
        let allureInput = document.getElementById("input-speed-pace2").value.trim();
        allureSecPerKm = allureToSecPerKm(allureInput);

        if (allureSecPerKm <= 0) {
            resDiv.innerHTML = "<p style='color:red;'>Veuillez saisir une allure/vitesse valide.</p>";
            return;
        }

    } else if (type === 'vma') {
        let vmaKmh = Number(document.getElementById("vma-seance").value);
        let percentVma = Number(document.getElementById("percent-vma-seance").value);

        if (isNaN(vmaKmh) || vmaKmh <= 0 || isNaN(percentVma) || percentVma <= 0 || percentVma > 100) {
            resDiv.innerHTML = "<p style='color:red;'>Veuillez saisir une VMA et un pourcentage VMA valides.</p>";
            return;
        }

        let speedKmh = vmaKmh * (percentVma / 100);
        allureSecPerKm = 3600 / speedKmh;
    }
    
    const totalSec = distanceKm * allureSecPerKm;
    const speedKmhFinal = secPerKmToKmh(allureSecPerKm);

    let output = '<div class="result-section">';
    output += `<h3>R√©sultats de la S√©ance</h3>`;
    output += `* Distance : ${distanceKm.toFixed(2)} km<br>`;
    output += `* Allure au km : ${secPerKmToAllure(allureSecPerKm)}/km<br>`;
    output += `* Vitesse : ${speedKmhFinal} km/h<br>`;
    output += `* Temps estim√© pour cette s√©ance : ${secToTime(totalSec)}`;
    output += '</div>';

    resDiv.innerHTML = output;
}


// --- 3. PR√âDICTION DE COURSE OU ZONES DE TRAVAIL (MISES √Ä JOUR) ---

function calculZones() {
    let vmaKmh = Number(document.getElementById("vma").value);
    let fcMax = Number(document.getElementById("fcmax").value);
    const resDiv = document.getElementById("res3");
    resDiv.innerHTML = '';

    if (isNaN(vmaKmh) || vmaKmh <= 0) {
        resDiv.innerHTML = "<p style='color:red;'>Veuillez saisir une VMA valide (en km/h).</p>";
        return;
    }

    // Mise √† jour des FCmax et suppression des pourcentages dans les noms
    const zones = [
        { name: "Allure mod√©r√©e / R√©cup√©ration", vmaMin: 50, vmaMax: 60, fcMin: 60, fcMax: 65, color: "#4CAF50", distance: null }, 
        { name: "Endurance fondamentale", vmaMin: 60, vmaMax: 70, fcMin: 65, fcMax: 75, color: "#8BC34A", distance: null }, 
        { name: "Endurance active / Tempo", vmaMin: 70, vmaMax: 75, fcMin: 75, fcMax: 85, color: "#FFC107", distance: null }, 
        { name: "Marathon", vmaMin: 75, vmaMax: 80, fcMin: 80, fcMax: 85, color: "#FF9800", distance: 42.195 }, 
        { name: "Semi-marathon", vmaMin: 80, vmaMax: 85, fcMin: 85, fcMax: 90, color: "#FF5722", distance: 21.0975 }, 
        { name: "10km", vmaMin: 85, vmaMax: 90, fcMin: 90, fcMax: 93, color: "#F44336", distance: 10 }, 
        { name: "5km", vmaMin: 90, vmaMax: 95, fcMin: 93, fcMax: 95, color: "#D32F2F", distance: 5 } 
    ];

    let output = '<h3>Zones de Travail estim√©es</h3>';
    output += `<p style="font-weight: bold; margin-bottom: 20px;">VMA : ${vmaKmh} km/h ${!isNaN(fcMax) && fcMax > 0 ? `, FCmax : ${fcMax} bpm` : ''}</p>`;

    zones.forEach(zone => {
        // Calcul VMA
        const speedMin = vmaKmh * (zone.vmaMin / 100);
        const speedMax = vmaKmh * (zone.vmaMax / 100);
        
        // Allure (s/km)
        const secPerKmMaxSpeed = 3600 / speedMax; // Allure la plus rapide (temps le plus faible)
        const secPerKmMinSpeed = 3600 / speedMin; // Allure la plus lente (temps le plus √©lev√©)
        
        // Formattage des tranches
        const speedRange = `${speedMin.toFixed(1)} - ${speedMax.toFixed(1)} km/h`;
        
        // Ordre d'affichage: Allure la plus lente - Allure la plus rapide (temps le plus √©lev√© -> temps le plus faible)
        const paceRange = `${secPerKmToAllure(secPerKmMinSpeed)} - ${secPerKmToAllure(secPerKmMaxSpeed)} min/km`;
        
        let fcRange = '';
        if (!isNaN(fcMax) && fcMax > 0) {
            const fcMin = Math.round(fcMax * (zone.fcMin / 100));
            const fcMaxBPM = Math.round(fcMax * (zone.fcMax / 100));
            // Affichage: Tranche (XXX - YYY bpm)
            fcRange = `${fcMin} - ${fcMaxBPM} bpm`;
        }

        // Pr√©diction de temps de course (uniquement pour les distances sp√©cifiques)
        let timePrediction = '';
        if (zone.distance) {
            // Temps le plus faible (vitesse max) -> Temps le plus √©lev√© (vitesse min)
            const timeMinSec = zone.distance * secPerKmMaxSpeed;
            const timeMaxSec = zone.distance * secPerKmMinSpeed;
            timePrediction = `<p>Temps estim√© : <span>${secToTime(timeMinSec)} - ${secToTime(timeMaxSec)}</span></p>`;
        }


        output += `<div class="zone-item" style="border-left-color: ${zone.color};">`;
        // Affichage du titre sans les % VMA
        output += `<div class="zone-title">${zone.name}</div>`;
        output += `<div class="zone-data">`;
        
        // Vitesse (afficher uniquement la tranche)
        output += `<p>Vitesse : <span>${speedRange}</span></p>`;
        
        // Allure (afficher ordre lent->rapide et min/km)
        output += `<p>Allure : <span>${paceRange}</span></p>`;
        
        // FC (afficher uniquement la tranche en bpm)
        if (fcRange) {
            output += `<p>FC : <span>${fcRange}</span></p>`;
        }
        
        // Temps estim√©
        output += timePrediction;
        output += `</div></div>`;
    });

    resDiv.innerHTML = output;
}


// --- INITIALISATION ---

document.addEventListener('DOMContentLoaded', () => {
    toggleSeanceInput('speed');
});

// Service worker
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
